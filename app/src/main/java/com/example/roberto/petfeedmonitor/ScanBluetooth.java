package com.example.roberto.petfeedmonitor;import android.bluetooth.BluetoothDevice;import android.content.Intent;import android.os.Bundle;import android.support.v7.app.AppCompatActivity;import android.view.View;import android.widget.AdapterView;import android.widget.ArrayAdapter;import android.widget.Button;import android.widget.ListView;import android.widget.ProgressBar;import android.widget.TextView;import com.example.roberto.heartratemonitor.R;import java.util.ArrayList;import java.util.List;import me.aflak.bluetooth.Bluetooth;public class ScanBluetooth extends AppCompatActivity implements Bluetooth.DiscoveryCallback,        AdapterView.OnItemClickListener{    private Bluetooth bluetooth;    private ListView listView;    private ArrayAdapter<String> adapter;    private TextView state;    private ProgressBar progress;    private Button scan;    private List<BluetoothDevice> devices;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        listView = (ListView)findViewById(R.id.scan_list);        state = (TextView) findViewById(R.id.scan_state);        progress = (ProgressBar) findViewById(R.id.scan_progress);        scan = (Button) findViewById(R.id.scan_scan_again);        adapter = new ArrayAdapter<>(this, android.R.layout.simple_list_item_1, new ArrayList<>());        listView.setAdapter(adapter);        listView.setOnItemClickListener(this);        bluetooth = new Bluetooth(this);        bluetooth.setDiscoveryCallback(this);        bluetooth.scanDevices();        progress.setVisibility(View.VISIBLE);        state.setText("Пребарување...");        listView.setEnabled(false);        scan.setEnabled(false);        devices = new ArrayList<>();        scan.setOnClickListener(v -> {            runOnUiThread(() -> {                adapter.clear();                scan.setEnabled(false);            });            devices = new ArrayList<>();            progress.setVisibility(View.VISIBLE);            state.setText("Скенирање...");            bluetooth.scanDevices();        });    }    private void setText(final String txt){        runOnUiThread(() -> state.setText(txt));    }    private void setProgressVisibility(final int id){        runOnUiThread(() -> progress.setVisibility(id));    }    @Override    public void onFinish() {        setProgressVisibility(View.INVISIBLE);        setText("Скенирањето е завршено!");        runOnUiThread(() -> {            scan.setEnabled(true);            listView.setEnabled(true);        });    }    @Override    public void onDevice(final BluetoothDevice device) {        devices.add(device);        runOnUiThread(() -> adapter.add(device.getAddress()+" - "+ device.getName()));    }    @Override    public void onPair(BluetoothDevice device) {        setProgressVisibility(View.INVISIBLE);        setText("Успешно поврзување!");        Intent i = new Intent(ScanBluetooth.this, SelectBluetooth.class);        startActivity(i);        finish();    }    @Override    public void onUnpair(BluetoothDevice device) {        setProgressVisibility(View.INVISIBLE);        setText("Завршено поврзување!");    }    @Override    public void onError(String message) {        setProgressVisibility(View.INVISIBLE);        setText("Грешка: "+message);    }    @Override    public void onItemClick(AdapterView<?> parent, View view, int position, long id) {        setProgressVisibility(View.VISIBLE);        setText("Се поврзува...");        bluetooth.pair(devices.get(position));    }}